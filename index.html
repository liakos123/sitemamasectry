<script>
  document.getElementById("year").textContent = new Date().getFullYear();

  const headerEl = document.querySelector("header");
  const btn = document.getElementById("menuBtn");
  const mobile = document.getElementById("mobileNav");

  function closeMobileMenu(){
    if (!btn || !mobile) return;
    btn.setAttribute("aria-expanded", "false");
    mobile.hidden = true;
  }

  // Toggle mobile menu
  btn?.addEventListener("click", () => {
    const isOpen = btn.getAttribute("aria-expanded") === "true";
    btn.setAttribute("aria-expanded", String(!isOpen));
    mobile.hidden = isOpen;

    // Αν ανοίξει το menu, κράτα το header εμφανές
    if (!isOpen) headerEl?.classList.remove("is-hidden");
  });

  // Close on link click
  mobile?.querySelectorAll("a").forEach(a => a.addEventListener("click", () => {
    closeMobileMenu();
    headerEl?.classList.remove("is-hidden");
  }));

  // Hide header on scroll-down (mobile only), show on scroll-up
  let lastY = window.scrollY || 0;
  let ticking = false;

  function handleScroll(){
    const y = window.scrollY || 0;

    // Μόνο mobile
    if (window.matchMedia("(max-width: 720px)").matches) {
      const delta = y - lastY;

      // Αν είσαι κοντά στην κορυφή, πάντα δείξε header
      if (y < 60) {
        headerEl?.classList.remove("is-hidden");
      } else {
        // Αγνόησε πολύ μικρές κινήσεις
        if (Math.abs(delta) > 8) {
          if (delta > 0) {
            // scroll down -> κρύψε + κλείσε menu (αν είναι ανοιχτό)
            closeMobileMenu();
            headerEl?.classList.add("is-hidden");
          } else {
            // scroll up -> δείξε
            headerEl?.classList.remove("is-hidden");
          }
        }
      }
    } else {
      // Σε desktop κράτα το όπως είναι
      headerEl?.classList.remove("is-hidden");
    }

    lastY = y;
    ticking = false;
  }

  window.addEventListener("scroll", () => {
    if (!ticking) {
      window.requestAnimationFrame(handleScroll);
      ticking = true;
    }
  }, { passive: true });
</script>
